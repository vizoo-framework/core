/* Vizoo - v0.1 - http://vizoo.online - Wallace Rio <wallrio@gmail.com> */
!function(o){var e=function(){};e.storage=function(o,e){if(void 0===e){if(null==(e=localStorage.getItem(o)))return e;try{e=atob(e),e=JSON.parse(e)}catch(e){return localStorage.removeItem(o),null}return e}if(null===e)return localStorage.removeItem(o),null;e=JSON.stringify(e),e=btoa(e),localStorage.setItem(o,e)},e.remove=function(o){e.storage("vizoo-session:"+o,null)},e.set=function(o,s){e.storage("vizoo-session:"+o,s)},e.get=function(o){return e.storage("vizoo-session:"+o)},e.check=function(o){return null!=e.get(o)},e.monitor=function(){document.querySelectorAll("[data-vizoo-session-logout]").map(function(){o.addEvent(this,"click",function(o,e){var s=e.getAttribute("data-vizoo-session-logout");if(null==s||void 0==s)return console.log("vizoo-plugin-session: session id not defined in logout button"),!1;vizoo.plugins.session.remove(s)},null,this)}),document.querySelectorAll("form[data-vizoo-session-form]").map(function(){if(1==this.initSessionFormTag)return!1;this.initSessionFormTag=1;var e=this.getAttribute("data-vizoo-session-form"),s=this.getAttribute("action"),t=this.getAttribute("data-vizoo-session-form-msg-error")||null;if(""==e)return console.log("vizoo-plugin-session: not found ID on data-vizoo-session-form "),!1;o.addEvent(this,"submit",function(e,s,n,i){e.preventDefault();var r=i,a={};for(key in s.elements){var u=s.elements[key].tagName,l=s.elements[key].name,c=s.elements[key].value;""!==l&&""!==c&&void 0!=u&&(a[l]=c)}var v=s.getAttribute("method")||"get";return void 0==a.username||void 0==a.password?(alert("Existem campos vazios."),!1):""==n?(console.log("vizoo-plugin-session: not found id on data-vizoo-session-form "),!1):(o.ajax({url:r,method:v,data:a,error:function(o){console.log(o),o=JSON.parse(o),void 0!=document.querySelector('[data-vizoo-session-form-response="'+n+'"]')&&(document.querySelector('[data-vizoo-session-form-response="'+n+'"]').innerHTML=null!=t?t:o.msg||"Error"),vizoo.plugins.session.remove(n)},success:function(o){if("success"==(o=JSON.parse(o)).status){var e=o.data||null;if(null===e||""===e)return console.log("vizoo-plugin-session: no data received"),!1;void 0!=document.querySelector('[data-vizoo-session-form-response="'+n+'"]')&&(document.querySelector('[data-vizoo-session-form-response="'+n+'"]').innerHTML=o.msg||"Success"),vizoo.plugins.session.set(n,e)}else null!=document.querySelector('[data-vizoo-session-form-response="'+n+'"]')&&(document.querySelector('[data-vizoo-session-form-response="'+n+'"]').innerHTML=null!=t?t:o.msg||"Error"),vizoo.plugins.session.remove(n)}}),!1)},null,this,e,s)}),document.querySelectorAll("[data-vizoo-session]").map(function(){if(1==this.initSessionTag)return!1;this.initSessionTag=1;var o,s=this.getAttribute("data-id"),t=e.check(s),n=this.querySelector("[data-vizoo-session-on]"),i=this.querySelector("[data-vizoo-session-off]");if(void 0==n)return console.log("vizoo-plugin-session: tag HTML [data-vizoo-session-on] not found"),!1;if(void 0==i)return console.log("vizoo-plugin-session: tag HTML [data-vizoo-session-off] not found"),!1;(n.classList.remove("active"),i.classList.remove("active"),1==t)?(o=(o=(o=(o=n.innerHTML).replace("{","<")).replace("}",">")).replace("{/","</"),n.innerHTML=o,n.classList.add("active")):(o=(o=(o=(o=i.innerHTML).replace("{","<")).replace("}",">")).replace("{/","</"),i.innerHTML=o,i.classList.add("active"));this.vizooSessionStatus=t;var r=function(o,s,t){var n=e.check(s);if(t.vizooSessionStatus!=n)return t.vizooSessionStatus=n,t.initSessionTag=0,!0;setTimeout(function(o,e,t){o(o,s,t)},1e3,o,s,t)};r(r,s,this)}),setTimeout(function(){e.monitor()})},e._construct=function(){e.monitor()},e._construct(),o.plugins.session=e}(vizoo);